<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioMap - Administração de Utilizadores</title>
    
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/x-icon" href="./img/biomap-icon.png">
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>
    
    <!-- Divider -->
    <div class="header-divider"></div>
    
    <!-- Main Content -->
    <main class="admin-users-content">
        <!-- Page Title -->
        <h1 class="admin-users-title">Administração de Utilizadores</h1>
        
        <!-- Search and Filters Section -->
        <div class="sidebar-content">
            <div class="search-section">
              <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="search-input" class="search-input" placeholder="Pesquisar">
              </div>
            </div>
    
            
          </div>
        
        <!-- Users Table -->
        <div class="admin-table-container">
            <table class="admin-users-table">
                <thead>
                    <tr>
                        <th>
                            Nome Utilizador
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Email
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Estado
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Estatuto
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>Suspender</th>
                        <th>Banir</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>John Smith</td>
                        <td>john.smith@gmail.com</td>
                        <td><span class="status-badge status-normal">Normal</span></td>
                        <td>Admin</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Olivia Bennett</td>
                        <td>ollyben@gmail.com</td>
                        <td><span class="status-badge status-suspended">Suspenso</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Michael Johnson</td>
                        <td>michael.j@outlook.com</td>
                        <td><span class="status-badge status-normal">Normal</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Sarah Williams</td>
                        <td>sarah.williams@yahoo.com</td>
                        <td><span class="status-badge status-suspended">Suspenso</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>David Brown</td>
                        <td>david.brown@gmail.com</td>
                        <td><span class="status-badge status-normal">Normal</span></td>
                        <td>Admin</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Emma Davis</td>
                        <td>emma.davis@hotmail.com</td>
                        <td><span class="status-badge status-suspended">Suspenso</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>James Wilson</td>
                        <td>james.wilson@gmail.com</td>
                        <td><span class="status-badge status-normal">Normal</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Sophia Martinez</td>
                        <td>sophia.m@outlook.com</td>
                        <td><span class="status-badge status-suspended">Suspenso</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Robert Taylor</td>
                        <td>robert.taylor@gmail.com</td>
                        <td><span class="status-badge status-normal">Normal</span></td>
                        <td>Admin</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Isabella Anderson</td>
                        <td>isabella.a@yahoo.com</td>
                        <td><span class="status-badge status-suspended">Suspenso</span></td>
                        <td>User</td>
                        <td><i class="fas fa-clock suspend-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="admin-pagination-container">
            <div class="pagination-info">
                <span>Linhas por pagina</span>
                <select class="pagination-select">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
                <span>de 140 linhas</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" title="Primeira página">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="pagination-btn" title="Página anterior">
                    <i class="fas fa-angle-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <span class="pagination-ellipsis">...</span>
                <button class="pagination-btn">10</button>
                <button class="pagination-btn" title="Próxima página">
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="pagination-btn" title="Última página">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script>
        // Load header when page loads
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof loadHeader === 'function') {
                loadHeader();
            }
        });

        // Search + sort + filter behaviour for admin users table
        function initAdminUserSearch() {
            const searchInput = document.getElementById('search-input');
            const table = document.querySelector('.admin-users-table');
            if (!table) return;

            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            if (!searchInput || rows.length === 0) return;

            // Store original index to be able to revert sort
            rows.forEach((row, index) => {
                row.dataset.originalIndex = index;
            });

            const normalizeText = (text) =>
                (text || '')
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '');

            // Sort / filter state
            let sortBy = null; // 'name' | 'email'
            let sortDir = 'asc'; // 'asc' | 'desc'
            let nameSortMode = 0;  // 0 = no sort, 1 = asc, 2 = desc
            let emailSortMode = 0; // 0 = no sort, 1 = asc, 2 = desc
            let statusMode = 0;  // 0 = all, 1 = only Suspenso, 2 = only Normal
            let roleMode = 0;    // 0 = all, 1 = only User, 2 = only Admin

            function applyFiltersAndSort() {
                const query = normalizeText(searchInput.value || '');

                rows.forEach(row => {
                    // Columns: 0 = Nome, 1 = Email, 2 = Estado (badge), 3 = Estatuto
                    const nameCell = row.cells[0];
                    const emailCell = row.cells[1];
                    const statusBadge = row.querySelector('.status-badge');
                    const roleCell = row.cells[3];

                    const name = nameCell ? normalizeText(nameCell.textContent) : '';
                    const email = emailCell ? normalizeText(emailCell.textContent) : '';
                    const status = statusBadge ? normalizeText(statusBadge.textContent) : '';
                    const role = roleCell ? normalizeText(roleCell.textContent) : '';

                    const matchesSearch =
                        !query ||
                        name.includes(query) ||
                        email.includes(query) ||
                        status.includes(query) ||
                        role.includes(query);

                    // Status mode: 0 = all, 1 = Suspenso, 2 = Normal
                    let matchesStatus = true;
                    if (statusMode === 1) {
                        matchesStatus = status.includes('suspenso');
                    } else if (statusMode === 2) {
                        matchesStatus = status.includes('normal');
                    }

                    // Role mode: 0 = all, 1 = User, 2 = Admin
                    let matchesRole = true;
                    if (roleMode === 1) {
                        matchesRole = role.includes('user');
                    } else if (roleMode === 2) {
                        matchesRole = role.includes('admin');
                    }

                    const visible = matchesSearch && matchesStatus && matchesRole;
                    row.style.display = visible ? '' : 'none';
                });

                // Apply sort (only affects visible rows order)
                let sortedRows = [...rows];
                if (sortBy) {
                    sortedRows.sort((a, b) => {
                        const idx = sortBy === 'name' ? 0 : 1; // 0 = name, 1 = email
                        const aText = normalizeText(a.cells[idx]?.textContent || '');
                        const bText = normalizeText(b.cells[idx]?.textContent || '');

                        if (aText < bText) return sortDir === 'asc' ? -1 : 1;
                        if (aText > bText) return sortDir === 'asc' ? 1 : -1;
                        // Fallback to original index to keep stable order
                        const aIdx = Number(a.dataset.originalIndex);
                        const bIdx = Number(b.dataset.originalIndex);
                        return aIdx - bIdx;
                    });
                } else {
                    // No sort: restore original order
                    sortedRows.sort((a, b) => Number(a.dataset.originalIndex) - Number(b.dataset.originalIndex));
                }

                // Re-append rows to tbody in the new order
                sortedRows.forEach(row => {
                    tbody.appendChild(row);
                });
            }

            // Search input listener
            searchInput.addEventListener('input', applyFiltersAndSort);

            // Sort / filter icon listeners
            const headerIcons = table.querySelectorAll('thead th .sort-icon');
            if (headerIcons.length >= 4) {
                // Nome Utilizador (index 0) - cycle: asc -> desc -> no sort
                headerIcons[0].addEventListener('click', () => {
                    nameSortMode = (nameSortMode + 1) % 3;
                    // Reset email sort when clicking on name
                    emailSortMode = 0;

                    if (nameSortMode === 0) {
                        sortBy = null;
                    } else {
                        sortBy = 'name';
                        sortDir = nameSortMode === 1 ? 'asc' : 'desc';
                    }

                    applyFiltersAndSort();
                });

                // Email (index 1) - cycle: asc -> desc -> no sort
                headerIcons[1].addEventListener('click', () => {
                    emailSortMode = (emailSortMode + 1) % 3;
                    // Reset name sort when clicking on email
                    nameSortMode = 0;

                    if (emailSortMode === 0) {
                        sortBy = null;
                    } else {
                        sortBy = 'email';
                        sortDir = emailSortMode === 1 ? 'asc' : 'desc';
                    }

                    applyFiltersAndSort();
                });

                // Estado (index 2) - cycle: Suspenso only -> Normal only -> All
                headerIcons[2].addEventListener('click', () => {
                    statusMode = (statusMode + 1) % 3;
                    applyFiltersAndSort();
                });

                // Estatuto (index 3) - cycle: User only -> Admin only -> All
                headerIcons[3].addEventListener('click', () => {
                    roleMode = (roleMode + 1) % 3;
                    applyFiltersAndSort();
                });
            }

            // Initial state (show all, original order)
            applyFiltersAndSort();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAdminUserSearch);
        } else {
            initAdminUserSearch();
        }
    </script>
</body>
</html>

