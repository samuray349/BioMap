<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioMap - Administração do registo animal</title>
    
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>
    
    <!-- Divider -->
    <div class="header-divider"></div>
    
    <!-- Main Content -->
    <main class="admin-animals-content">
        <!-- Page Title -->
        <h1 class="admin-animals-title">Administração do registo animal</h1>
        
        <!-- Search and Filters Section -->
        <div class="sidebar-content">
            <div class="search-section">
              <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="search-input" class="search-input" placeholder="Pesquisar">
              </div>
            </div>
    
            <div class="filters-row">
            
              <div class="filter-section">
                <label class="filter-label">Estado de conservação</label>
                <div class="tag-input-wrapper">
                  <input type="text" id="state-input" class="tag-input" placeholder="Selecionar estado de conservação" autocomplete="off">
                  <div class="tag-container" id="state-tags"></div>
                  <i class="fas fa-chevron-down filter-arrow"></i>
                  <div class="dropdown-menu" id="state-dropdown"></div>
                </div>
              </div>

              <div class="filter-section">
                <label class="filter-label">Família</label>
                <div class="tag-input-wrapper">
                  <input type="text" id="family-input" class="tag-input" placeholder="Selecionar família" autocomplete="off">
                  <div class="tag-container" id="family-tags"></div>
                  <i class="fas fa-chevron-down filter-arrow"></i>
                  <div class="dropdown-menu" id="family-dropdown"></div>
                </div>
              </div>
            </div>
          </div>
        
        <!-- Animals Table -->
        <div class="admin-table-container">
            <table class="admin-animals-table">
                <thead>
                    <tr>
                        <th>
                            Nome Animal
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Família
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Estado de cons
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>Atualizar</th>
                        <th>Excluir</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Animal rows will be loaded dynamically from API -->
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="admin-pagination-container">
            <div class="pagination-info">
                <span>Linhas por paginas</span>
                <select class="pagination-select">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
                <span>de 140 linhas</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" title="Primeira página">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="pagination-btn" title="Página anterior">
                    <i class="fas fa-angle-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <span class="pagination-ellipsis">...</span>
                <button class="pagination-btn">10</button>
                <button class="pagination-btn" title="Próxima página">
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="pagination-btn" title="Última página">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script src="js/animals.js"></script>
    <script>
        // Load header when page loads
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof loadHeader === 'function') {
                loadHeader();
            }
        });

        // Tag arrays specific to admin_animal.html
        let adminFamilyTags = [];
        let adminStateTags = [];

        const familyOptions = [
            "Felidae", "Canidae", "Ursidae", "Mustelidae",
            "Cervidae", "Suidae", "Leporidae", "Sciuridae",
            "Accipitridae", "Bovidae", "Lacertidae", "Psittacidae"
        ];

        const stateOptions = [
            "Não Avaliada", "Dados Insuficientes", "Pouco Preocupante", "Quase Ameaçada",
            "Vulnerável", "Em Perigo", "Perigo Crítico", "Extinto na Natureza", "Extinto"
        ];

        const tbody = document.querySelector('.admin-animals-table tbody');
        const searchInput = document.getElementById('search-input');

        // Load and render animals
        async function loadAnimals() {
            try {
                const filters = getAnimalFilters({
                    searchInput: searchInput,
                    familyTagsArray: adminFamilyTags,
                    stateTagsArray: adminStateTags
                });
                
                const animals = await fetchAnimals(filters);
                renderAnimalTable(animals, tbody);
            } catch (error) {
                console.error("Erro ao carregar animais:", error);
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5">Erro ao carregar dados.</td></tr>';
                }
            }
        }

        function initAdminAnimalFilters() {
            // Initialize filters
            initAnimalFilters({
                familyInputId: "family-input",
                familyTagsId: "family-tags",
                familyDropdownId: "family-dropdown",
                stateInputId: "state-input",
                stateTagsId: "state-tags",
                stateDropdownId: "state-dropdown",
                familyOptions: familyOptions,
                stateOptions: stateOptions,
                familyTagsArray: adminFamilyTags,
                stateTagsArray: adminStateTags,
                onFilterChange: loadAnimals
            });

            // Search input triggers load
            if (searchInput) {
                searchInput.addEventListener('input', loadAnimals);
            }

            // Initial load
            loadAnimals();
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAdminAnimalFilters);
        } else {
            initAdminAnimalFilters();
        }
    </script>
</body>
</html>

