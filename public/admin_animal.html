<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioMap - Administração do registo animal</title>
    
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>
    
    <!-- Divider -->
    <div class="header-divider"></div>
    
    <!-- Main Content -->
    <main class="admin-animals-content">
        <!-- Page Title -->
        <h1 class="admin-animals-title">Administração do registo animal</h1>
        
        <!-- Search and Filters Section -->
        <div class="sidebar-content">
            <div class="search-section">
              <div class="search-wrapper">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="search-input" class="search-input" placeholder="Pesquisar">
              </div>
            </div>
    
            <div class="filters-row">
            
              <div class="filter-section">
                <label class="filter-label">Estado de conservação</label>
                <div class="tag-input-wrapper">
                  <input type="text" id="state-input" class="tag-input" placeholder="Selecionar estado de conservação" autocomplete="off">
                  <div class="tag-container" id="state-tags"></div>
                  <i class="fas fa-chevron-down filter-arrow"></i>
                  <div class="dropdown-menu" id="state-dropdown"></div>
                </div>
              </div>

              <div class="filter-section">
                <label class="filter-label">Família</label>
                <div class="tag-input-wrapper">
                  <input type="text" id="family-input" class="tag-input" placeholder="Selecionar família" autocomplete="off">
                  <div class="tag-container" id="family-tags"></div>
                  <i class="fas fa-chevron-down filter-arrow"></i>
                  <div class="dropdown-menu" id="family-dropdown"></div>
                </div>
              </div>
            </div>
          </div>
        
        <!-- Animals Table -->
        <div class="admin-table-container">
            <table class="admin-animals-table">
                <thead>
                    <tr>
                        <th>
                            Nome Animal
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Família
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>
                            Estado de cons
                            <i class="fas fa-sort sort-icon"></i>
                        </th>
                        <th>Atualizar</th>
                        <th>Excluir</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Vison-europeu</td>
                        <td>Mustelidae</td>
                        <td><span class="badge critical">Perigo crítico</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Águia-imperial-ibérica</td>
                        <td>Accipitridae</td>
                        <td><span class="badge endangered">Em perigo</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Sapo-parteiro-de-Majorca</td>
                        <td>Alytidae</td>
                        <td><span class="badge endangered">Em perigo</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Lince Ibérico</td>
                        <td>Felidae</td>
                        <td><span class="badge vulnerable">Vulnerável</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Esturjão-europeu</td>
                        <td>Acipenseridae</td>
                        <td><span class="badge endangered">Em perigo</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Corvo-marinho-de-faces-branca</td>
                        <td>Phalacrocoracidae</td>
                        <td><span class="badge threatened">Quase ameaçada</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Tritão-alpino</td>
                        <td>Salamandridae</td>
                        <td><span class="badge threatened">Quase ameaçada</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Lobo-ibérico</td>
                        <td>Canidae</td>
                        <td><span class="badge vulnerable">Vulnerável</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Peixe-panda da Grécia</td>
                        <td>Gasterosteidae</td>
                        <td><span class="badge critical">Perigo crítico</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Foca-monge-do-mediterrâneo</td>
                        <td>Phocidae</td>
                        <td><span class="badge vulnerable">Vulnerável</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                    <tr>
                        <td>Cegonha-negra</td>
                        <td>Ciconiidae</td>
                        <td><span class="badge threatened">Quase ameaçada</span></td>
                        <td><i class="fas fa-sync-alt update-icon"></i></td>
                        <td><i class="fas fa-ban ban-icon"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="admin-pagination-container">
            <div class="pagination-info">
                <span>Linhas por paginas</span>
                <select class="pagination-select">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
                <span>de 140 linhas</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" title="Primeira página">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="pagination-btn" title="Página anterior">
                    <i class="fas fa-angle-left"></i>
                </button>
                <button class="pagination-btn active">1</button>
                <button class="pagination-btn">2</button>
                <button class="pagination-btn">3</button>
                <span class="pagination-ellipsis">...</span>
                <button class="pagination-btn">10</button>
                <button class="pagination-btn" title="Próxima página">
                    <i class="fas fa-angle-right"></i>
                </button>
                <button class="pagination-btn" title="Última página">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </main>
    
    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script>
        // Load header when page loads
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof loadHeader === 'function') {
                loadHeader();
            }
        });

        // Tag arrays specific to admin_animal.html
        let adminFamilyTags = [];
        let adminStateTags = [];

        const familyOptions = [
            "Felidae", "Canidae", "Ursidae", "Mustelidae",
            "Cervidae", "Suidae", "Leporidae", "Sciuridae",
            "Rodentia", "Chiroptera", "Carnivora", "Artiodactyla",
            "Felídeos", "Psittacidae", "Accipitridae",
            "Lacertidae", "Bovidae", "Suídeos"
        ];

        const stateOptions = [
            "Vulnerável", "Em perigo", "Quase ameaçada",
            "Pouco Preocupante", "Dados Insuficientes",
            "Extinto na Natureza", "Extinto", "Perigo crítico"
        ];

        function initAdminAnimalFilters() {
            const familyInput = document.getElementById('family-input');
            const stateInput = document.getElementById('state-input');
            const searchInput = document.getElementById('search-input');
            const rows = document.querySelectorAll('.admin-animals-table tbody tr');

            // Initialize tag inputs
            if (familyInput && stateInput && typeof initTagInputWithDropdown === 'function') {
                initTagInputWithDropdown("family-input", "family-tags", "family-dropdown", adminFamilyTags, familyOptions);
                initTagInputWithDropdown("state-input", "state-tags", "state-dropdown", adminStateTags, stateOptions);
            } else if (familyInput || stateInput) {
                // If elements exist but function doesn't, wait a bit and try again
                setTimeout(initAdminAnimalFilters, 100);
                return;
            }

            if (rows.length === 0) return;

            const normalizeText = (text) =>
                (text || '')
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '');

            function filterRows() {
                const query = searchInput ? normalizeText(searchInput.value || '') : '';

                rows.forEach(row => {
                    const nameCell = row.cells[0]; // Nome Animal
                    const familyCell = row.cells[1]; // Família
                    const stateBadge = row.querySelector('.badge'); // Estado de cons

                    const name = nameCell ? normalizeText(nameCell.textContent) : '';
                    const family = familyCell ? normalizeText(familyCell.textContent) : '';
                    const state = stateBadge ? normalizeText(stateBadge.textContent) : '';

                    const matchesSearch =
                        !query ||
                        name.includes(query) ||
                        family.includes(query) ||
                        state.includes(query);

                    const matchesFamily =
                        adminFamilyTags.length === 0 ||
                        adminFamilyTags.some(tag => normalizeText(tag) === family);

                    const matchesState =
                        adminStateTags.length === 0 ||
                        adminStateTags.some(tag => normalizeText(tag) === state);

                    row.style.display = (matchesSearch && matchesFamily && matchesState) ? '' : 'none';
                });
            }

            // Search input triggers filter
            if (searchInput) {
                searchInput.addEventListener('input', filterRows);
            }

            // Observe tag DOM changes to re-run filter when tags change
            const observerConfig = { childList: true };
            const famContainer = document.getElementById('family-tags');
            const stateContainer = document.getElementById('state-tags');

            const tagObserver = new MutationObserver(filterRows);
            if (famContainer) tagObserver.observe(famContainer, observerConfig);
            if (stateContainer) tagObserver.observe(stateContainer, observerConfig);

            // Initial filter
            filterRows();
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAdminAnimalFilters);
        } else {
            initAdminAnimalFilters();
        }
    </script>
</body>
</html>

