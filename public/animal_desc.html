<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioMap</title>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/x-icon" href="./img/biomap-icon.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9fafb;
        }

        /* --- Animal Card Styles --- */
        .animal-card {
            background-color: #ffffff;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px #1987548c;
            overflow: hidden;
            display: flex;
            flex-direction: row; 
            margin-bottom: 3rem;
            border: 1px solid rgba(0,0,0,0.05);
            /* REMOVED fixed min-height to prevent it from being artificially tall */
            align-items: stretch; /* Ensures text background stretches to match image height */
        }
        .animal-card.main {
    max-width: 1400px; /* or 1500px */
    width: 100%;
    margin-left: auto;
    margin-right: auto;
}



        .animal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 13px #1987548c;
        }

        /* --- Image Styling --- */
        .card-image-section {
            /* CHANGED: Increased to 65% to make the image "longer" horizontally */
            width: 65%; 
            position: relative;
        }

        .card-image-section img {
            width: 100%;
            height: 100%;
            /* CHANGED: Re-enforce 16:9 so height is calculated strictly by width */
            aspect-ratio: 16 / 9; 
            object-fit: cover; 
            object-position: center;
            display: block;
        }

        /* --- Content Styling --- */
        .card-content-section {
            /* CHANGED: Reduced to 35% to give space to the image */
            width: 35%;
            padding: 2.5rem 2rem; 
            display: flex;
            flex-direction: column;
            justify-content: center; /* Centers content vertically */
            position: relative;
        }

        .card-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
            gap: 10px;
        }

        .animal-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent-color, #198754);
            margin: 0;
            line-height: 1.1;
        }

        .scientific-name {
            font-style: italic;
            color: #6b7280;
            font-size: 1rem;
            margin-top: 0.25rem;
        }

        .status-badge {
            color: #ffffff;
            font-weight: 600;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            white-space: nowrap;
            align-self: flex-start;
        }

        .section-title {
            color: var(--accent-color, #198754);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            margin-top: 0;
            text-align: left;
        }

        .facts-grid {
            display: grid;
            grid-template-columns: 1fr; /* Single column fits better in the narrower 35% space */
            gap: 12px;
            margin-bottom: 1.5rem;
        }
        
        /* If screen is huge, we can go back to 2 cols */
        @media (min-width: 1400px) {
            .facts-grid { grid-template-columns: 1fr 1fr; }
        }

        .fact-label {
            color: var(--accent-color, #198754);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 2px;
            display: block;
        }

        .fact-value {
            color: #1f2937;
            font-weight: 500;
            font-size: 1rem;
        }

        .description-text {
            color: #4b5563;
            line-height: 1.6;
            font-size: 0.95rem;
            margin: 0;
        }

        /* Threat items utility */
        .threat-item { position: relative; padding-left: 1.5rem; color: #4b5563; }
        /* Custom Green Dot Marker */
        .threat-item::before {
            content: "";
            position: absolute;
            left: 0;
            top: 8px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #198754;
        }


        /* Responsive behavior */
        @media (max-width: 900px) {
            .animal-card { flex-direction: column; }
            .card-image-section, .card-content-section { width: 100%; }
            .card-image-section img { aspect-ratio: 16/9; } /* Keep wide aspect on mobile too */
            .card-content-section { padding: 2rem; }
            .facts-grid { grid-template-columns: 1fr 1fr; } /* Restore grid on mobile */
        }
    </style>
</head>
<body class="min-h-screen bg-white">
    <div id="page-loader" class="page-loader">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Carragar...</span>
        </div>
      </div>
    <div id="header-placeholder"></div>

    <main class="container mx-auto px-4 py-12" style="max-width: 1500px;">
        <div class="mx-auto" style="max-width: 1500px;">
            <div class="mx-auto mb-8" style="max-width: 1400px;">
                <div class="flex justify-end">
                    <button class="px-3 py-1 border border-gray-300 rounded-full text-sm bg-white hover:bg-gray-50 transition">
                        Partilhar
                    </button>
                </div>
            </div>
            

            <div class="animal-card main">
                <div class="card-image-section">
                    <img src="" alt="" id="imagem-animal">
                </div>
                
                <div class="card-content-section">
                    <div class="card-header-row">
                        <div>
                            <h1 class="animal-title" id="nome-comum"></h1>
                            <p class="scientific-name" id="nome-cientifico"></p>
                        </div>
                        <span class="status-badge" id="estado-conservacao"></span>
                    </div>

                    <div class="mb-6">
                        <h3 class="section-title" id="factos-title">Factos</h3>
                        <div class="facts-grid">
                            <div>
                                <span class="fact-label">Família:</span>
                                <span class="fact-value" id="familia"></span>
                            </div>
                            <div>
                                <span class="fact-label">Dieta:</span>
                                <span class="fact-value" id="dieta"></span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="section-title" id="descricao-title">Descrição</h3>
                        <p class="description-text" id="descricao"></p>
                    </div>
                </div>
            </div>
            <div style="max-width: 1200px;margin-right: auto;margin-left: auto;">
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div class="bg-white p-6 rounded-xl shadow animal-card" style="flex-direction: column; display: flex; height: 100%; margin-bottom: 0px;">
                    <h3 class="text-xl font-semibold mb-4" style="color: var(--accent-color, #198754);" id="ameacas-title">5 Principais Ameaças</h3>
                    <ul class="space-y-3" style="list-style-type: none;">
                        <li class="threat-item" id="ameaca-1"></li>
                        <li class="threat-item" id="ameaca-2"></li>
                        <li class="threat-item" id="ameaca-3"></li>
                        <li class="threat-item" id="ameaca-4"></li>
                        <li class="threat-item" id="ameaca-5"></li>
                    </ul>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow animal-card" style="flex-direction: column; display: flex; align-self: stretch;">
                    <div style="display: flex; flex-direction: column; gap: 1rem; flex-grow: 1;">
                        <h3 class="text-xl font-semibold" style="color: var(--accent-color, #198754); margin: 0;" id="estado-conservacao-title">Estado de Conservação</h3>
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center mr-4" style="background-color: #FFCC00; color: black;" id="estado-conservacao-icon">
                                <i data-feather="alert-triangle"></i>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm" style="margin-bottom: 0;">Lista Vermelha IUCN</p>
                                <p class="font-medium" id="estado-conservacao-texto"></p>
                            </div>
                        </div>
                        <p class="text-gray-700" style="margin: 0;" id="populacao-estimada"></p>
                    </div>
                    <a href="doar.html" class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90 transition w-full flex items-center justify-center" style="background-color: var(--accent-color); text-decoration: none; margin-top: auto;">
                        <i data-feather="heart" class="inline mr-2" id="doar-icon"></i> Doar
                    </a>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow mb-12 animal-card" style="flex-direction: row; align-items: flex-start; height: auto;">
                <div class="w-12 h-12 rounded-full  flex items-center justify-center mr-4 flex-shrink-0" style="background-color: var(--accent-color); color: white;" id="info-icon">
                    <i data-feather="info"></i>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" id="facto-interessante-title">Facto interessante</h3>    
                    <p class="text-gray-700" id="facto-interessante-texto"></p>
                </div>
            </div>
        </div>
        </div>
    </main>

    <script>
        feather.replace();
    </script>
    <script src="js/script.js"></script>
    <script>
        // Loader
  window.addEventListener('load', () => {
            const loader = document.getElementById('page-loader');
            setTimeout(() => {
                if (loader) {
                    loader.classList.add('hidden');
                    // Optional: Remove loader from DOM after animation
                    loader.addEventListener('transitionend', () => loader.remove());
                }
            }, 300);
        });

        if (typeof loadHeader === 'function') {
            loadHeader();
        }

        async function fetchAnimalDesc() {
            try {
            const params = new URLSearchParams(window.location.search);
    
            // 2. Extract the 'id' parameter
            const animalId = params.get('id');
            console.log(animalId);
            if (!animalId) {
                console.error("ID do animal não encontrado");
                return;
            }
            if (!/^\d+$/.test(animalId)) {
                // Case B: ID is not a number (e.g., ?id=abc)
                document.body.innerHTML = '<h1>Erro: ID inválido.</h1>';
                return;
            }
            // Buscar dos animais da API
            const response = await fetch(`/animaisDesc/${animalId}`);
            const animal = await response.json();

            renderAnimalDesc(animal);   

          } catch (error) {
              console.error("Erro ao buscar animal:", error);
          }
        }
        function renderAnimalDesc(animal) {
            document.title="BioMap - " + animal.nome_comum;
            document.getElementById('nome-comum').textContent = animal.nome_comum;
            document.getElementById('nome-cientifico').textContent = animal.nome_cientifico;
            document.getElementById('estado-conservacao').textContent = animal.nome_estado;
            document.getElementById('estado-conservacao').style.backgroundColor = animal.estado_cor;
            document.getElementById('estado-conservacao-icon').style.backgroundColor = animal.estado_cor;
            document.getElementById('familia').textContent = animal. nome_familia;
            document.getElementById('dieta').textContent = animal.nome_dieta;
            document.getElementById('descricao').textContent = animal.descricao;
            document.getElementById('imagem-animal').src = animal.url_imagem;
            document.getElementById('imagem-animal').alt = animal.nome_comum;
            document.getElementById('facto-interessante-texto').textContent = animal.facto_interessante_texto;
            document.getElementById('estado-conservacao-texto').textContent = animal.nome_estado;
            document.getElementById('populacao-estimada').textContent = "População estimada: " + animal.populacao_estimada;
            document.getElementById('ameaca-1').textContent = animal.ameacas[0];
            document.getElementById('ameaca-2').textContent = animal.ameacas[1];
            document.getElementById('ameaca-3').textContent = animal.ameacas[2];
            document.getElementById('ameaca-4').textContent = animal.ameacas[3];
            document.getElementById('ameaca-5').textContent = animal.ameacas[4];
            document.getElementById('facto-interessante-texto').textContent = animal.facto_interessante;  
        }
        fetchAnimalDesc();
    </script>
</body>
</html>